<section class="todoapp">
    <header class="header">
        <h1>todos</h1>
        <form id="new-form">
            <input type="text" class="new-todo" />
            <!--input type="submit" class="submit-button" value="Add Task" /-->
        </form>
    </header>

    <section class="main">
        <ul class="todo-list">
        
        </ul>
    </section>
</section>


<script>
    $(() => {

        function taskHtml(task) {
                // The taskHtml method takes in a JavaScript representation
                // of the task and produces an HTML representation using
                // <li> tags
            var checkedStatus = task.done ? "checked" : "";
            var liElement = '<li><div class="view"><input class="toggle" type="checkbox"' +
                " data-id='" + task.id + "'" + 
                checkedStatus +
                '><label>' +
                task.title +
                '</label></div></li>';

            return liElement;
        };

        function toggleTask(e) {
                // toggleTask takes in an HTML representation of
                // an event that fires from an HTML representation of
                // the toggle checkbox and  performs an API request to toggle
                // the value of the `done` field
            var itemId = $(e.target).data("id");
            var doneValue = Boolean($(e.target).is(':checked'));
            $.post("/tasks/" + itemId, {
                _method: "PUT",
                task: {
                    done: doneValue
                }
            });
        };

        $.get("/tasks").success(( data ) => {
            var htmlString = "";
            $.each(data, (index, task) => {
                htmlString += taskHtml(task);
            });
            $('.todo-list').html(htmlString);
            $('.toggle').change(toggleTask);
        });

        $('#new-form').submit((event) => {
            event.preventDefault();
            var newtask = $('.new-todo').val();
            var addtask = newtask.charAt(0).toUpperCase() + newtask.slice(1)
            var payload = {
                task: {title: addtask, done: false}
            };      

            $.post("/tasks", payload).success((data) => {
                var htmlString = taskHtml(data);
                $('.todo-list').append(htmlString);
                $('.toggle').click(toggleTask);
            });
        });
    });
</script>